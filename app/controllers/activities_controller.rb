class ActivitiesController < ApplicationController
  before_filter :prepare_params
  
  def checkin
    params[:report].delete(:type)
    
    @business.reports.create(params[:report])
    @account.reports.create(params[:report])
    @place.reports.create(params[:report])
    
    @report.activity_type = "checkin"
    if @report.save
      respond_to do |format|
        format.html { render :text => "Forbidden", :status => :forbidden }
        format.xml { render :nothing => true, :status => :ok }
        format.json { render :nothing => true, :status => :ok }
      end
    end
  end
  
  def redeem
    params[:report].delete(:type)
    
    @business.reports.create(params[:report])
    @account.reports.create(params[:report])
    @place.reports.create(params[:report])
    
    @report.activity_type = "redeem"
    if @report.save
      respond_to do |format|
        format.html { render :text => "Forbidden", :status => :forbidden }
        format.xml { render :nothing => true, :status => :ok }
        format.json { render :nothing => true, :status => :ok }
      end
    end
  end
  
  private
  def prepare_params
    business_id = params[:report].delete(:business_id)
    place_id = params[:report].delete(:place_id)
    
    @business = Business.where(business_id)
    @account  = Account.where(params[:report][:account_id])
    @place    = Place.where(place_id)
  end
end