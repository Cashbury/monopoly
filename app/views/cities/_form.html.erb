
<%= javascript_include_tag      'jquery.tipTip',
                                "http://maps.google.com/maps/api/js?sensor=true",
%>


<%= form_for(@city, :html=>{:class=>"mono-form cities"}) do |f| %>
  <% if @city.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@city.errors.count, "error") %> prohibited this city from being saved:</h2>

      <ul>
      <% @city.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <p>
    <%= f.label "name" %>
    <%= f.text_field :name , :class=>"title" %>
  </p>

  <div id="city_map" style="height:400px; width:400px">

  </div>
  <p>
    <%= f.label "country" %>
    <%= f.text_field   :country ,   :value=> @city.try(:country).try(:name) ,  :id=>"country_id",:class=>"title double"%>
    <%= f.hidden_field :country_id, :id=>"country",   :class=>"title double"%>
  </p>


  <p>
    <%= f.label :time_zone %>
    <%= f.time_zone_select :time_zone, ActiveSupport::TimeZone.all%>
  </p>
  </p>
    <%= f.label :phone_area_code %>
    <%= f.text_field :phone_area_code, :class=>"title" %>
  </p>
  </p>
    <%= f.label :lat %>
    <%= f.text_field :lat, :class=>"title" %>
  </p>
    <%= f.label :long %>
    <%= f.text_field :lng, :class=>"title" %>
  </p>

  <p>
    <%= f.check_box :is_live  %>
    <%= f.label :is_live %>
  </p>

  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>

<script type="text/javascript">
var initialLocation;
var siberia = new google.maps.LatLng(60, 105);
var newyork = new google.maps.LatLng(40.69847032728747, -73.9514422416687);
var browserSupportFlag =  new Boolean();

function initialize() {
  var myOptions = {
    zoom: 6,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var mapV = new google.maps.Map(document.getElementById("city_map"), myOptions);
  var pos= new google.maps.LatLng("<%= @city.lat.to_s %>","<%= @city.lng.to_s %>")
  var markerV = new google.maps.Marker({position: pos ,map:mapV});
  markerV.setDraggable(true);
  mapV.setCenter(pos);

  google.maps.event.addListener(markerV,"dragend",function(){
    mapV.panTo(markerV.getPosition());
    jQuery('input#city_lat').val(markerV.getPosition().lat());
    jQuery('input#city_lng').val(markerV.getPosition().lng());
  });
}

jQuery(document).ready(initialize)
</script>

