<head>
<%= javascript_include_tag 'users_management_scripts' , 'bday-picker.min'%>
</head>
<% title "User | #{@user.full_name}" %>
<p><%= link_to 'Edit', edit_users_management_path(@user) %> </p>
<% user_uid=@user.email.split("@facebook").first %>
<%=image_tag @user.email.match(/facebook/) ? "https://graph.facebook.com/#{user_uid}/picture?type=large" : "/images/user-default.jpg", :style=>"float:right;" %>
<table class="mono-table" style="width:500px" border="0" cellspacing="0" cellpadding="0">
  <caption><h4>User Account</h4></caption>
  <tr><td style="width:70px"><b>Username: </b></td><td><%= @user.username %></td></tr>
  <tr><td style="width:70px"><b>First Name: </b></td><td><%= @user.first_name %></td></tr>
  <tr><td style="width:70px"><b>Last Name: </b></td><td><%= @user.last_name %></td></tr>
  <tr><td style="width:70px"><b>Password:  </b></td>
  <td>    
    <%= form_tag "/users_management/resend_password" do %>
      <div style="display:none;">
        <%= email_field_tag "user[email]", @user.email%>
      </div>
      <%= link_to "Resend reset password instructions","javascript:void(0)", {:id=>"resend_password_link"} %>
    <% end %>
  </td>
  </tr>
  <tr><td style="width:70px"><b>Email:  </b></td>
  <td><%=@user.email%> | <%=@user.confirmed_at.nil? ? "Not confirmed" : "Confirmed" %> | <%= form_tag "/users_management/send_confirmation_email" do %>
      <div style="display:none;"><%= email_field_tag "user[email]", @user.email%></div>
      <%= link_to "Send Confirmation Email","javascript:void(0)", {:id=>"send_confirmation_email"} %>
    <% end %>
  </td>
  </tr>
  <tr><td style="width:70px"><b>Telephone Number:  </b></td><td><%= @user.telephone_number %></td></tr>
  <% unless @user.mailing_address.nil? %>
  <tr>
    <td style="width:70px"><b>Mailing Address:  </b></td>
    <td>
      <b>Street Address: </b><%=@user.mailing_address.street_address%><br/>      
      <b>City: </b><%=@user.mailing_address.city.try(:name)%><br/>
      <b>Country: </b><%=@user.mailing_address.country.try(:name)%><br/>
      <b>Zipcode: </b><%=@user.mailing_address.zipcode%><br/>
    </td>
  </tr>  
  <% end %>
  <% unless @user.billing_address.nil? %>
  <tr>
    <td style="width:70px"><b>Billing Address:  </b></td>
    <td>
      <b>Street Address: </b><%=@user.billing_address.street_address%><br/>  
      <b>City: </b><%=@user.billing_address.city.try(:name)%><br/>
      <b>Country: </b><%=@user.billing_address.country.try(:name)%><br/>
      <b>Zipcode: </b><%=@user.billing_address.zipcode%><br/>
    </td>
  </tr>  
  <% end %>
  <tr><td style="width:70px"><b>DOB:  </b></td><td><%= @user.dob %></td></tr>
  <tr><td style="width:70px"><b>Note:  </b></td><td><%= @user.note %></td></tr>
  <tr><td style="width:70px"><b>Legal Ids:  </b></td>
    <td>
    <% @user.legal_ids.each do |legal| %>
    <%=LegalType.find(legal.legal_type_id).displayed_type%> : <%= legal.id_number %><br/>
    <%end%>
    </td>
  </tr>
</table>
<br/>
<table class="mono-table" style="width:500px" border="0" cellspacing="0" cellpadding="0">
  <%=hidden_field_tag :user_id, @user.id %>
  <caption><h4>System Info</h4></caption>
  <tr><td style="width:92px"><b>User Type: </b></td><td><%=@user.roles.collect{|r| r.name}.join(' , ')%></td></tr>
  <tr><td style="width:92px"><b>Home Town: </b></td><td><%=@user.try(:country).try(:name)%></td></tr>
  <tr><td style="width:92px"><b>Account Status: </b></td>
    <td><span id="status"><%=@user.active ? "Active" : "Inactive"%></span> | <%=link_to "Suspend", "javascript:void(0)", {:id=>"suspend_link"}%> | <%=link_to "Reactivate", "javascript:void(0)", {:id=>"reactivate_link"}%>
    <img src="/images/loading.gif" width="16" height="16" alt="Loading" style="display:none;" /></td>     
  </tr>
  <tr><td style="width:92px"><b>User Since: </b></td><td><%=@user.created_at.to_date%></td></tr>
  <tr><td style="width:92px"><b>Facebook-Account-Linked: </b></td><td><%=@user.is_fb_account ? "Yes" : "No"%></td></tr>
  <tr><td style="width:92px"><b>User ID: </b></td><td><%=@user.system_id%></td></tr>
</table>
<%unless @user.qr_code.nil? %>
<br/>
<div id="user_code">
<table class="mono-table" style="width:500px" border="0" cellspacing="0" cellpadding="0">
<caption><h4>User ID: <%=@user.system_id%></h4></caption>
  <tr>
    <td><%= link_to (image_tag @user.qr_code.qr_code_image.photo.url, :width=>"50px", :height=>"50px"), qr_code_path(@user.qr_code)  %></td>
    <td><%=@user.qr_code.status ? "Active" : "Inactive"%></td>
    <td><%=link_to "View Txs" ,"#"%></td>
    <td><%=link_to "Re-issue", "javascript:void(0)", {:id=>"reissue_code"}%><img src="/images/loading.gif" width="16" height="16" alt="Loading" style="display:none;" /></td>
  </tr>
</table>
</div>
<%end%>
<br/>
<h3>Cash Account @ Cashbury: <%=@user.money_account_at_large.try(:amount)%></h3>
<h3>Manage User Program Enrollment @ a Business</h3>
<%= select_tag :program_type_id, "<option value=''>...Program Type...</option>".html_safe + options_from_collection_for_select(ProgramType.all, "id", "name", ProgramType.find_by_name(ProgramType::AS[:marketing]).try(:id)), {:id=>"program_type_selector"}%>
<img src="/images/loading.gif" width="16" height="16" alt="Loading" style="display:none;" />
<div id="listing_businesses_container">
  <%=render :partial=>"listing_enrollments_container"%>
</div>
<p><%=link_to "Deposit/Withdraw to/from SVA accounts @ businesses", manage_user_accounts_users_management_path(@user)%></p>
<p><%=link_to "Redeem a reward @ businesses", redeem_rewards_users_management_path(@user)%></p>
<p><%=link_to "Engage @ campaign @ businesses", list_engagements_users_management_path(@user)%></p>
<p><%=link_to "Show Logged Actions", logged_actions_users_management_path(@user)%></p>
