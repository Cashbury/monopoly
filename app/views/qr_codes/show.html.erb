<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
<title>View Qr Code</title>
<style type="text/css">
  #qr_code {text-align:center;}
  #qr_code img{
    margin-top: 30px;
    background:#fff;
    border:40px red solid;
  }
  .qr_code_view_container {
    width: 380px;
    margin: 0 auto;
    font-family: Arial;
    font-size: 12px;
    padding-top:50px;
    padding-bottom:130px; 
  }
  .c_crowned_logo {
    text-align:center;
  }
  .qr_code_hash{
    margin: 0 auto;
    padding: 10px 0;
    text-align: center;


  }
  .qr_code_hash b{margin: 0 auto;   font-size: 16px;font-family: Arial;}
  .details {padding-left:14px;float:left;width:100%;clear:both;}
  .details img {float:left;width:27px;margin:0 10px}
  .details p{margin:0px;font-family: Arial;color:#666;}
  .record_feeds img {float:left;width:50px;margin-top: 5px;}
  .record_feeds {border:1px grey solid;clear:both;overflow:auto; padding:9px; margin-bottom:10px; }
  .feed_text {float:left;width:300px;margin-left:10px}
  .feed_text p{padding:0;margin-top:0;margin-bottom:5px;}
</style>
<%= javascript_include_tag :defaults %>
<script src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/XdCommReceiver.js" mce_src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/XdCommReceiver.js" type="text/javascript"></script>
<script type="text/javascript">
  jQuery(document).ready(function(){
    var timer, delay = 2000, index=0; 
    send_check_request();
    timer = setInterval(function(){
      send_check_request();
    }, delay);
    function send_check_request(){
      jQuery.ajax({
        type: 'GET',
        url: '/check_status/<%=@qr_code.id%>?index='+index,
        ifModified: true,
        success: function(data){
          if(data!=null){
            if(data.response_text!="" && index!=data.index){jQuery('#scan_response').append(data.response_text);}
            index=data.index;
          }
        }
      });
    }
  });
</script>
</head>
<body style="background-color:yellow">
<!--<script type="text/javascript" src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php" mce_src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php"> </script>-->
<script type="text/javascript">
  //FB.init({
  //        appId   : '131547350250149',
  //        status  : true, // check login status
  //        cookie  : true, // enable cookies to allow the server to access the session
  //        xfbml   : true // parse XFBML
  //});

  //jQuery(document).ready(function(){
  //FB_RequireFeatures(["XFBML", "Api"], function() {
 //FB.Facebook.init('131547350250149','/xd_receiver.html',{"ifUserConnected": update_user_box});




 //}); 
 // });
 // FB.init("131547350250149", '/xd_receiver.html', {});
 // FB.XFBML.Host.parseDomTree();
</script>
<div class="qr_code_view_container">
  <div class="c_crowned_logo"><%= image_tag "/images/C-Crowned.png"  %></div>
  <div id="qr_code"><%= image_tag @qr_code.qr_code_image.try(:photo).try(:url)  %></div>
  <div class="qr_code_hash"><b>Reference Number: <%=@qr_code.hash_code%></b></div>
  <div id="scan_response"></div>
  <p style="color:#666; width:100%; text-align:center;clear:both">
  <% unless @engagement_type.is_visit %>
    <b>Details: Get a stamp for ordering <%=@engagement.name.gsub("Buy ","")%> @ <%=@brand.name%></b>
  <%else%>
    <b>Details: Get a stamp for visiting <%=@brand.name%></b>
  <% end %>
  </p>
  <div class="details"><%= image_tag "/images/Snapit.png"  %><p><b>Snap code using your cashbury app.</b></p><p><b>To download the app follow me</b></p></div>
</div>
<!--<img src="https://graph.facebook.com/735570560/picture"/> 
<fb:profile-pic uid="735570560" facebook-logo="true" linked="false" width="300" height="400"></fb:profile-pic>-->
</body>

</html>
