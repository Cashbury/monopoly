<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
<title>View Qr Code</title>
<link href='http://fonts.googleapis.com/css?family=Play&subset=greek,latin&v1' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Anonymous+Pro&v1' rel='stylesheet' type='text/css'>
<style type="text/css">
  #qr_code {text-align:center;}
  #qr_code img{
    margin-top: 30px;
    background:#fff;
    border:40px red solid;
  }
  .qr_code_view_container {
    width: 380px;
    margin: 0 auto;
    font-family: Arial;
    font-size: 12px;
    padding-top:50px;
    padding-bottom:130px; 
  }
  .c_crowned_logo {
    text-align:center;
  }
  .qr_code_hash{
    margin: 0 auto;
    padding: 10px 0;
    text-align: center;


  }
  .qr_code_hash b{margin: 0 auto;   font-size: 16px;font-family: Arial;}
  .details {padding-left:14px;float:left;width:100%;clear:both;}
  .details img {float:left;width:27px;margin:0 10px}
  .details p{margin:0px;font-family: Arial;color:#666;}
  .record_feeds img {float:left;width:50px;margin-top: 5px;}
  .record_feeds {border:1px grey solid;clear:both;overflow:auto; padding:9px; margin-bottom:10px; }
  .feed_text {float:left;width:300px;margin-left:10px}
  .feed_text p{padding:0;margin-top:0;margin-bottom:5px;}
  .font1 {font-family: Play;font-size: 12px;}
  .font2 {font-family: Anonymous Pro;font-size: 16px;}
  .toggle_link{display:none; clear:both;  text-align: right;}
  .toggle_link a{font-family:Helvetica; font-size:16px;color:#CDCDCD;text-decoration:none;}
  .toggle_link #toggle_p{margin-right:15px}
  #scan_response {margin-top:10px;}
  .font_selected_state {color:red;}
</style>
<%= javascript_include_tag :defaults %>
<script src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/XdCommReceiver.js" mce_src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/XdCommReceiver.js" type="text/javascript"></script>
<script type="text/javascript">
  jQuery(document).ready(function(){
    var timer, delay = 2000, index=0; 
    send_check_request();
    timer = setInterval(function(){
      send_check_request();
    }, delay);
    jQuery('#toggle_a').click(function(){
      jQuery('#scan_response').removeClass('font1');
      jQuery('#scan_response').addClass('font2');
      //jQuery(this).addClass('font_selected_state');
      jQuery(this).css('color','red');
      jQuery('#toggle_p').css('color','#CDCDCD');
      //jQuery('#toggle_p').removeClass('font_selected_state');
    });
    jQuery('#toggle_p').click(function(){
      jQuery('#scan_response').removeClass('font2');
      jQuery('#scan_response').addClass('font1');
      //jQuery(this).addClass('font_selected_state');
      jQuery(this).css('color','red');
      //jQuery('#toggle_a').removeClass('font_selected_state');
      jQuery('#toggle_a').css('color','#CDCDCD');
    });
    function send_check_request(){
      jQuery.ajax({
        type: 'GET',
        url: '/check_status/<%=@qr_code.id%>?index='+index,
        ifModified: true,
        success: function(data){
          if(data!=null){
            if(data.response_text!="" && index!=data.index){jQuery('#scan_response').append(data.response_text);}
            index=data.index;
            jQuery('.toggle_link').show();
          }
        }
      });
    }
  });
</script>
</head>
<body style="background-color:yellow">
<div class="qr_code_view_container">
  <div class="c_crowned_logo"><%= image_tag "/images/C-Crowned.png"  %></div>
  <div id="qr_code"><%= image_tag @qr_code.qr_code_image.try(:photo).try(:url)  %></div>
  <div class="qr_code_hash"><b>Reference Number: <%=@qr_code.hash_code%></b></div>
  <div class="toggle_link"><a id="toggle_p" style="color:red" href="javascript:void(0)">Play</a> <a id="toggle_a" href="javascript:void(0)">Anonymous Pro</a></div>
  <div id="scan_response" class="font1"></div>
  <p style="color:#666; width:100%; text-align:center;clear:both">
  <% unless @engagement_type.is_visit %>
    <b>Details: Get a stamp for ordering <%=@engagement.name.gsub("Buy ","")%> @ <%=@brand.name%></b>
  <%else%>
    <b>Details: Get a stamp for visiting <%=@brand.name%></b>
  <% end %>
  </p>
  <div class="details"><%= image_tag "/images/Snapit.png"  %><p><b>Snap code using your cashbury app.</b></p><p><b>To download the app follow me</b></p></div>
</div>
</body>

</html>
