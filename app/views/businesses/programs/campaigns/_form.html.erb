<script type="text/javascript">
 $(document).ready(function(){ 
  $("#measurement_type_selection").change(function () {
      other_option = $(":selected", this).text();
      if(other_option == "Other")
        $('#new_measurement_type_div').show();
      else
        $('#new_measurement_type_div').hide();
  });
});
</script>

<%= form_for([@business,@program,@campaign]) do |f| %>
  <% if @campaign.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@campaign.errors.count, "error") %> prohibited this campaign from being saved:</h2>

      <ul>
      <% @campaign.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div class="field">
    <%= label_tag "Who is this campaign offered to?" %>
    <%= select_tag "target_id", "<option value=''>...Everyone...</option>".html_safe+options_from_collection_for_select(Target.all, "id", "display_name",@campaign.targets.first.try(:id)) %>
  </div>
  <div class="field">
    <%= f.label "Campaign Type" %><%= mark_required(@campaign, :measurement_type) %>
    <%= f.select :ctype,Campaign::CTYPE.each_pair{|k,v| [k,v]}  %>
  </div>
  <div class="field">
    <%= f.label "Name #{mark_required(@campaign, :name)}" %>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <%= f.label :start_date %>
    <%= f.text_field :start_date, :value=>Date.today, :id=>"datepicker" %>
  </div>
  <div class="field">
    <%= f.label :end_date %>
    <%= f.text_field :end_date, {:id=>"datepicker"} %>
  </div>
  <div class="field">
    <%= f.label "Measurement type #{mark_required(@campaign, :measurement_type_id)}" %>
    <%= f.select :measurement_type_id,@measurement_types.collect { |mt| [mt.name,mt.id]}, {}, {:id=>"measurement_type_selection"} %>
  </div>
  
  <div class="field" id="new_measurement_type_div" style="display:none">
    <%= label_tag :measurement_name %><br />
    <%= text_field_tag :measurement_name %>
   </div>
  
  <div class="field">
    <%= f.label :initial_amount %>
    <%= f.text_field :initial_amount %>
  </div>
  <div class="field">
    <%= f.label :initial_biz_amount %>
    <%= f.text_field :initial_biz_amount %>
  </div>
  <div class="field">
     <fieldset>
      <legend>Assign Campaign to Places</legend>
      <p>
        <%= f.label :places, "Places" %><br />
        <% @business.places.each do |place| %>
          <% listed_places= @campaign.new_record? ? @business.places : @campaign.places%>
          <%= check_box_tag("campaign[places_list][#{place.id}]", "1", listed_places.detect{|i| i.id == place.id}) %>
          <%= "#{place.name}"%><br />
        <% end %>
      </p>
    </fieldset>
  </div>
  <br />
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
